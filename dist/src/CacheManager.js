Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _class,_temp,_this=this;var _expo=require("expo");var _sha=require("crypto-js/sha1");var _sha2=_interopRequireDefault(_sha);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var CacheManager=(_temp=_class=function(){function CacheManager(){_classCallCheck(this,CacheManager);}_createClass(CacheManager,null,[{key:"cache",value:function cache(uri,listener){var _ref,path,exists;return regeneratorRuntime.async(function cache$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return regeneratorRuntime.awrap(getCacheEntry(uri));case 2:_ref=_context.sent;path=_ref.path;exists=_ref.exists;if(!isDownloading(uri)){_context.next=9;break;}addListener(uri,listener);_context.next=24;break;case 9:if(!exists){_context.next=13;break;}listener(path);_context.next=24;break;case 13:addListener(uri,listener);_context.prev=14;_context.next=17;return regeneratorRuntime.awrap(_expo.FileSystem.downloadAsync(uri,path));case 17:notifyAll(uri,path);_context.next=23;break;case 20:_context.prev=20;_context.t0=_context["catch"](14);notifyAll(uri,uri);case 23:unsubscribe(uri);case 24:case"end":return _context.stop();}}},null,this,[[14,20]]);}}]);return CacheManager;}(),_class.listeners={},_temp);exports.default=CacheManager;var unsubscribe=function unsubscribe(uri){return delete CacheManager.listeners[uri];};var notifyAll=function notifyAll(uri,path){return CacheManager.listeners[uri].forEach(function(listener){return listener(path);});};var addListener=function addListener(uri,listener){if(!CacheManager.listeners[uri]){CacheManager.listeners[uri]=[];}CacheManager.listeners[uri].push(listener);};var isDownloading=function isDownloading(uri){return CacheManager.listeners[uri]!==undefined;};var getCacheEntry=function getCacheEntry(uri){var filename,ext,path,info,exists;return regeneratorRuntime.async(function getCacheEntry$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:filename=uri.substring(uri.lastIndexOf("/"),uri.indexOf("?")===-1?uri.length:uri.indexOf("?"));ext=filename.indexOf(".")===-1?".jpg":filename.substring(filename.lastIndexOf("."));path=_expo.FileSystem.cacheDirectory+(0,_sha2.default)(uri)+ext;_context2.next=5;return regeneratorRuntime.awrap(_expo.FileSystem.getInfoAsync(path));case 5:info=_context2.sent;exists=info.exists;return _context2.abrupt("return",{exists:exists,path:path});case 8:case"end":return _context2.stop();}}},null,_this);};
//# sourceMappingURL=CacheManager.js.map